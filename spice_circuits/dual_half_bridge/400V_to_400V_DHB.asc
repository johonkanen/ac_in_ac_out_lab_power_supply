Version 4
SHEET 1 3064 1092
WIRE -880 -208 -880 -240
WIRE -720 -208 -880 -208
WIRE -192 -208 -720 -208
WIRE 0 -208 -192 -208
WIRE 640 -192 640 -240
WIRE 640 -192 576 -192
WIRE 752 -192 640 -192
WIRE -256 -160 -320 -160
WIRE -192 -160 -192 -208
WIRE 0 -160 0 -208
WIRE 576 -160 576 -192
WIRE -384 -80 -384 -160
WIRE -336 -80 -384 -80
WIRE -256 -80 -256 -160
WIRE -240 -80 -256 -80
WIRE -384 -48 -384 -80
WIRE -192 -32 -192 -64
WIRE 144 -32 -192 -32
WIRE 320 -32 224 -32
WIRE 896 -16 896 -112
WIRE 896 -16 704 -16
WIRE 992 -16 896 -16
WIRE 1008 -16 992 -16
WIRE 1120 -16 1120 -128
WIRE 1120 -16 1088 -16
WIRE 1184 -16 1120 -16
WIRE 1360 -16 1264 -16
WIRE 1488 -16 1360 -16
WIRE 1648 -16 1488 -16
WIRE 704 0 704 -16
WIRE 0 48 0 -96
WIRE 224 48 0 48
WIRE 320 48 224 48
WIRE 896 48 896 -16
WIRE -384 64 -384 32
WIRE -192 64 -192 -32
WIRE -192 64 -384 64
WIRE -720 80 -720 -208
WIRE 592 80 432 80
WIRE 816 80 672 80
WIRE 224 112 224 48
WIRE 432 112 432 80
WIRE -352 128 -384 128
WIRE -256 128 -288 128
WIRE 816 128 816 80
WIRE 848 128 816 128
WIRE 1648 144 1648 -16
WIRE 1792 144 1648 144
WIRE -192 160 -192 64
WIRE 576 160 576 -80
WIRE 704 160 704 64
WIRE 704 160 576 160
WIRE 0 176 0 48
WIRE 992 208 992 -16
WIRE 1120 208 1120 -16
WIRE 1360 208 1360 -16
WIRE 1488 208 1488 -16
WIRE 1648 208 1648 144
WIRE 432 224 432 192
WIRE 752 224 752 -192
WIRE 752 224 432 224
WIRE 896 224 896 144
WIRE 896 224 752 224
WIRE -384 240 -384 128
WIRE -336 240 -384 240
WIRE -256 240 -256 128
WIRE -240 240 -256 240
WIRE 704 240 704 160
WIRE 896 240 896 224
WIRE -384 256 -384 240
WIRE 576 272 432 272
WIRE 432 304 432 272
WIRE 576 320 576 272
WIRE 592 320 576 320
WIRE 848 320 672 320
WIRE -720 368 -720 160
WIRE -384 368 -384 336
WIRE -384 368 -720 368
WIRE -192 368 -192 256
WIRE -192 368 -384 368
WIRE 0 368 0 240
WIRE 0 368 -192 368
WIRE 704 368 704 304
WIRE 832 368 704 368
WIRE 896 368 896 336
WIRE 896 368 832 368
WIRE 992 368 992 272
WIRE 992 368 896 368
WIRE 1120 368 1120 272
WIRE 1120 368 992 368
WIRE 1360 368 1360 272
WIRE 1360 368 1120 368
WIRE 1488 368 1488 272
WIRE 1488 368 1360 368
WIRE 1648 368 1648 288
WIRE 1648 368 1488 368
WIRE 704 384 704 368
WIRE 704 384 432 384
WIRE -192 400 -192 368
WIRE 832 400 832 368
WIRE 992 416 992 368
FLAG -192 400 0
FLAG 992 416 0
FLAG 224 112 transformer_primary
FLAG 640 -240 transformer_secondary
FLAG -880 -240 input_voltage
FLAG 1120 -128 filter2
FLAG 896 -112 secondary_rect
FLAG 1792 144 output_voltage
SYMBOL ind2 304 -48 R0
SYMATTR InstName L1
SYMATTR Value {Lm}
SYMATTR Type ind
SYMATTR SpiceLine Rser=100m
SYMBOL ind2 592 -64 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L2
SYMATTR Value {Lsec}
SYMATTR Type ind
SYMATTR SpiceLine Rser=100m
SYMBOL nmos -240 160 R0
SYMATTR InstName M1
SYMATTR Value IPB65R420CFD
SYMBOL nmos -240 -160 R0
SYMATTR InstName M2
SYMATTR Value IPB65R420CFD
SYMBOL voltage -384 -64 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value PULSE(0 15 {dt_pri1+pri_dly} 1n 1n {d1} {Ts})
SYMBOL voltage -384 240 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 10 214 Left 2
SYMATTR Value PULSE(15 0 {dt_pri2+pri_dly} 1n 1n {d2} {Ts})
SYMATTR InstName V2
SYMBOL res -240 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1
SYMBOL res -240 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1
SYMBOL voltage -720 64 R0
WINDOW 123 0 0 Left 2
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=0.01
SYMATTR InstName V5
SYMATTR Value 400
SYMBOL cap 976 208 R0
SYMATTR InstName C5
SYMATTR Value 10µ
SYMATTR SpiceLine Rser=10m
SYMBOL cap -16 176 R0
SYMATTR InstName C1
SYMATTR Value 5µ
SYMATTR SpiceLine Rser=10m
SYMBOL cap -16 -160 R0
SYMATTR InstName C2
SYMATTR Value 5µ
SYMATTR SpiceLine Rser=10m
SYMBOL cap 1104 208 R0
SYMATTR InstName C3
SYMATTR Value 100n
SYMATTR SpiceLine Rser=10m
SYMBOL cap 1344 208 R0
SYMATTR InstName C4
SYMATTR Value 100n
SYMATTR SpiceLine Rser=10m
SYMBOL ind2 1168 0 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 4 56 VBottom 2
SYMATTR InstName L5
SYMATTR Value 100n
SYMATTR Type ind
SYMATTR SpiceLine Rser=1m
SYMBOL ind2 992 0 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 4 56 VBottom 2
SYMATTR InstName L6
SYMATTR Value 100n
SYMATTR Type ind
SYMATTR SpiceLine Rser=1m
SYMBOL cap 1472 208 R0
SYMATTR InstName C6
SYMATTR Value 100n
SYMATTR SpiceLine Rser=10m
SYMBOL cap 688 240 R0
SYMATTR InstName C7
SYMATTR Value 5µ
SYMATTR SpiceLine Rser=10m
SYMBOL cap 688 0 R0
SYMATTR InstName C8
SYMATTR Value 5µ
SYMATTR SpiceLine Rser=10m
SYMBOL nmos 848 48 R0
SYMATTR InstName M3
SYMATTR Value IPB65R420CFD
SYMBOL nmos 848 240 R0
SYMATTR InstName M4
SYMATTR Value IPB65R420CFD
SYMBOL voltage 432 288 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value PULSE(15 0 {dt_pri2+sec_dly} 1n 1n {d2} {Ts})
SYMBOL voltage 432 96 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value PULSE(0 15 {dt_pri1+sec_dly} 1n 1n {d1} {Ts})
SYMBOL res 688 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1
SYMBOL res 688 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1
SYMBOL voltage 1648 192 R0
WINDOW 123 0 0 Left 2
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=0.01
SYMATTR InstName V6
SYMATTR Value 400
SYMBOL ind2 240 -48 R90
WINDOW 0 4 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L3
SYMATTR Value {Ll}
SYMATTR Type ind
SYMATTR SpiceLine Rser=100m
SYMBOL diode -320 -176 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value 1N914
SYMBOL diode -288 112 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D2
SYMATTR Value 1N914
TEXT 288 -64 Left 2 !K1 L1 L2 {K}
TEXT -752 424 Left 2 !.tran 0 5.8m 5.3m 100n
TEXT 1368 -552 Left 2 !.param duty= 0.5; half bridge duty ratio\n.param fsw=150k ; Switching frequency\n.param dt=100n ; dead time
TEXT 1368 -432 Left 2 !.param Ts= 1/fsw; switch cycle time\n.param d1= 1/fsw*duty-dt; high side switch on time\n.param d2= 1/fsw*duty+dt; dead time
TEXT 688 -504 Left 2 !.param Npri = 32\n.param Nsec = 32\n.param Lm=151.8u\n.param leakage_inductance = 5u\n \n.param Ll = 100n\n.param Lsec= Lm/(Npri/Nsec)/(Npri/Nsec)\n.param K = sqrt(1-leakage_inductance/Lm)
TEXT 1368 -296 Left 2 !.param dt_sec =100n;switch cycle time\n.param d1_sec= 1/fsw/2-dt_sec; high side switch on time\n.param d2_sec= 1/fsw/2+dt_sec; dead time
TEXT 1368 -192 Left 2 !.param dt_pri1=dt_sec+dt/2 ; Switching frequency\n.param dt_pri2=dt_sec-dt/2; dead time
TEXT -608 -368 Left 2 !.param pri_dly= 0
TEXT -608 -336 Left 2 !.param sec_dly=  delay
TEXT 1768 -16 Left 2 !.ic V(filter2)=410
TEXT 2088 -208 Left 2 !.meas Iin AVG -I(V5)\n.meas Iout AVG I(V6)\n.meas Pin AVG -I(V5)*V(input_voltage)\n.meas Pout AVG I(V6)*V(output_voltage)\n.meas Eff param Pout/Pin\n.meas Ploss param Pin-Pout
TEXT -608 -448 Left 2 !.param ph_ctrl=15
TEXT 1768 56 Left 2 !.ic V(secondary_rect)=410
TEXT -608 -536 Left 2 ;Change ph_ctrl between 0 to 100 to get from 0 to full electrical power. \nReasonable range below 40 as reactive power gets too high\nPower direction can be changed by switching whether the delay is in primary or secondary
TEXT -600 -400 Left 2 !.param delay = 1/fsw/2+1/fsw/4*ph_ctrl/100
